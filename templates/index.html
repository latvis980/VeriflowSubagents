<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Fact Checker & Bias Analyzer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç AI Fact Checker & Bias Analyzer</h1>
            <p class="subtitle">Verify facts and analyze bias from ChatGPT, Perplexity outputs, and other texts</p>
        </header>

        <main>
            <!-- Mode Selection Section -->
            <section class="mode-selection-section">
                <h2>Choose Analysis Mode</h2>
                <div class="mode-tabs">
                    <button class="mode-tab active" data-mode="llm-output">
                        <span class="mode-icon">ü§ñ</span>
                        <span class="mode-label">LLM Output Verification</span>
                        <span class="mode-desc">ChatGPT, Perplexity, Claude with sources</span>
                    </button>
                    <button class="mode-tab" data-mode="text-factcheck">
                        <span class="mode-icon">üîç</span>
                        <span class="mode-label">Text Fact-Checking</span>
                        <span class="mode-desc">Plain text without links</span>
                    </button>
                    <button class="mode-tab" data-mode="bias-analysis">
                        <span class="mode-icon">üìä</span>
                        <span class="mode-label">Bias Analysis</span>
                        <span class="mode-desc">Detect political & ideological bias</span>
                    </button>
                </div>
            </section>

            <!-- Input Section -->
            <section class="input-section">
                <!-- LLM Output Mode Instructions -->
                <div id="llmOutputInstructions" class="mode-instructions">
                    <div class="instructions-card">
                        <h3>üìã How to Copy LLM Output</h3>
                        <div class="instructions-steps">
                            <div class="step">
                                <span class="step-number">1</span>
                                <span class="step-text">Go to your ChatGPT, Perplexity, or Claude conversation</span>
                            </div>
                            <div class="step">
                                <span class="step-number">2</span>
                                <span class="step-text">Find the response you want to verify</span>
                            </div>
                            <div class="step">
                                <span class="step-number">3</span>
                                <span class="step-text">Click the <strong>"Copy"</strong> button (üìã) on the response</span>
                            </div>
                            <div class="step">
                                <span class="step-number">4</span>
                                <span class="step-text">Paste here with <kbd>Ctrl</kbd>+<kbd>V</kbd> (or <kbd>Cmd</kbd>+<kbd>V</kbd>)</span>
                            </div>
                        </div>
                        <div class="instructions-note">
                            <span class="note-icon">üí°</span>
                            <span>The copied content should include HTML links to sources. If your text has no links, use "Text Fact-Checking" mode instead.</span>
                        </div>
                    </div>
                </div>

                <!-- Text Fact-Check Mode Instructions -->
                <div id="textFactcheckInstructions" class="mode-instructions" style="display: none;">
                    <div class="instructions-card">
                        <h3>üìù Text Fact-Checking</h3>
                        <p>Paste any plain text and we'll search the web to verify the facts.</p>
                        <div class="instructions-note">
                            <span class="note-icon">üí°</span>
                            <span>Best for news articles, social media posts, or any text without embedded source links.</span>
                        </div>
                    </div>
                </div>

                <!-- Bias Analysis Mode Instructions -->
                <div id="biasAnalysisInstructions" class="mode-instructions" style="display: none;">
                    <div class="instructions-card">
                        <h3>üìä Bias Analysis</h3>
                        <p>Paste any text to analyze it for political, ideological, or other biases using dual-model AI analysis.</p>
                        <div class="instructions-note">
                            <span class="note-icon">üí°</span>
                            <span>Works with news articles, opinion pieces, or any written content. Optionally specify the publication name for context.</span>
                        </div>
                    </div>
                </div>

                <div class="section-header">
                    <h2 id="inputSectionTitle">üìã Paste LLM Output</h2>
                    <p class="help-text" id="inputHelpText">Copy the full response from ChatGPT/Perplexity using the Copy button</p>
                </div>

                <div class="input-wrapper">
                    <textarea 
                        id="htmlInput" 
                        placeholder="Paste your content here...&#10;&#10;For LLM Output mode:&#10;Copy the response using the Copy button from ChatGPT or Perplexity.&#10;&#10;For other modes:&#10;Just paste plain text."
                        rows="12"
                    ></textarea>

                    <!-- Content Format Indicator -->
                    <div id="contentFormatIndicator" class="content-format-indicator" style="display: none;">
                        <span id="formatIcon"></span>
                        <span id="formatMessage"></span>
                    </div>

                    <!-- Publication Field (for Bias Analysis mode) -->
                    <div id="publicationField" class="publication-field" style="display: none;">
                        <label for="publicationName">
                            Publication Name (optional):
                            <input type="text" id="publicationName" placeholder="e.g., New York Times, Fox News">
                        </label>
                    </div>

                    <div class="input-actions">
                        <button id="clearBtn" class="btn-secondary">Clear</button>
                        <button id="checkBtn" class="btn-primary">
                            <span class="btn-text">Verify Sources</span>
                            <span class="btn-loading" style="display: none;">
                                <span class="spinner"></span> Processing...
                            </span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Plain Text Warning Modal -->
            <div id="plainTextModal" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-icon">‚ö†Ô∏è</div>
                    <h3>No Links Detected</h3>
                    <p>This looks like plain text without source links. LLM Output Verification requires content with embedded links.</p>
                    <div class="modal-options">
                        <p><strong>Would you like to:</strong></p>
                        <button id="switchToTextMode" class="btn-option">
                            <span class="option-icon">üîç</span>
                            <span class="option-text">
                                <strong>Switch to Text Fact-Checking</strong>
                                <small>Search the web to verify these facts</small>
                            </span>
                        </button>
                        <button id="switchToBiasMode" class="btn-option">
                            <span class="option-icon">üìä</span>
                            <span class="option-text">
                                <strong>Switch to Bias Analysis</strong>
                                <small>Analyze this text for bias instead</small>
                            </span>
                        </button>
                        <button id="continueAnyway" class="btn-link">Continue with LLM Output mode anyway</button>
                    </div>
                    <button id="closeModal" class="modal-close">√ó</button>
                </div>
            </div>

            <!-- Status Section -->
            <section id="statusSection" class="status-section" style="display: none;">
                <div class="status-card">
                    <div class="status-header">
                        <div class="spinner"></div>
                        <h2>Processing...</h2>
                    </div>

                    <div class="progress-log" id="progressLog">
                        <!-- Progress messages appear here -->
                    </div>

                    <div class="status-actions">
                        <button id="stopBtn" class="btn-stop">
                            <span class="btn-text">üõë Stop Analysis</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Results Section with Tabs -->
            <section id="resultsSection" class="results-section" style="display: none;">
                <div class="results-tabs">
                    <button class="tab-btn active" data-tab="fact-check" id="factCheckTab" style="display: none;">
                        üîç Fact Checking
                    </button>
                    <button class="tab-btn" data-tab="bias-analysis" id="biasAnalysisTab" style="display: none;">
                        üìä Bias Analysis
                    </button>
                </div>

                <!-- Fact Check Results Tab -->
                <div id="factCheckResults" class="tab-content active">
                    <!-- Summary Card -->
                    <div class="summary-card">
                        <h2>üìä Summary</h2>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <div class="summary-label">Total Facts</div>
                                <div class="summary-value" id="totalFacts">0</div>
                            </div>
                            <div class="summary-item accurate">
                                <div class="summary-label">Accurate (‚â•0.9)</div>
                                <div class="summary-value" id="accurateFacts">0</div>
                            </div>
                            <div class="summary-item good">
                                <div class="summary-label">Good (0.7-0.9)</div>
                                <div class="summary-value" id="goodFacts">0</div>
                            </div>
                            <div class="summary-item questionable">
                                <div class="summary-label">Questionable (&lt;0.7)</div>
                                <div class="summary-value" id="questionableFacts">0</div>
                            </div>
                            <div class="summary-item">
                                <div class="summary-label">Avg Score</div>
                                <div class="summary-value" id="avgScore">0%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Facts List -->
                    <div class="facts-list" id="factsList">
                        <!-- Facts will be populated here -->
                    </div>

                    <!-- Session Info -->
                    <div class="session-info">
                        Session ID: <code id="sessionId">-</code>
                        <span class="separator">‚Ä¢</span>
                        Processing Time: <span id="processingTime">0s</span>
                        <span class="separator">‚Ä¢</span>
                        <a id="auditLink" href="#" target="_blank" style="display: none;">üìÑ View Full Report</a>
                    </div>
                </div>

                <!-- Bias Analysis Results Tab -->
                <div id="biasAnalysisResults" class="tab-content">
                    <!-- Bias Summary -->
                    <div class="bias-summary-card">
                        <h2>üìä Bias Analysis Summary</h2>
                        <div class="bias-scores-grid">
                            <div class="bias-score-item">
                                <div class="bias-score-label">GPT-4o Score</div>
                                <div class="bias-score-value" id="gptBiasScore">-</div>
                                <div class="bias-score-direction" id="gptBiasDirection">-</div>
                            </div>
                            <div class="bias-score-item">
                                <div class="bias-score-label">Claude Score</div>
                                <div class="bias-score-value" id="claudeBiasScore">-</div>
                                <div class="bias-score-direction" id="claudeBiasDirection">-</div>
                            </div>
                            <div class="bias-score-item consensus">
                                <div class="bias-score-label">Consensus Score</div>
                                <div class="bias-score-value" id="consensusBiasScore">-</div>
                                <div class="bias-score-direction" id="consensusBiasDirection">-</div>
                            </div>
                        </div>
                    </div>

                    <!-- Model Tabs -->
                    <div class="model-tabs">
                        <button class="model-tab active" data-model="gpt">GPT-4o Analysis</button>
                        <button class="model-tab" data-model="claude">Claude Analysis</button>
                        <button class="model-tab" data-model="consensus">Consensus</button>
                    </div>

                    <!-- GPT Analysis Content -->
                    <div id="gptAnalysis" class="model-content active">
                        <div class="analysis-card">
                            <h3>üìù Overall Assessment</h3>
                            <p id="gptOverallAssessment">-</p>
                        </div>
                        <div class="analysis-card">
                            <h3>üéØ Bias Indicators</h3>
                            <ul id="gptBiasIndicators"></ul>
                        </div>
                        <div class="analysis-card">
                            <h3>üìñ Language Analysis</h3>
                            <p id="gptLanguageAnalysis">-</p>
                        </div>
                    </div>

                    <!-- Claude Analysis Content -->
                    <div id="claudeAnalysis" class="model-content">
                        <div class="analysis-card">
                            <h3>üìù Overall Assessment</h3>
                            <p id="claudeOverallAssessment">-</p>
                        </div>
                        <div class="analysis-card">
                            <h3>üéØ Bias Indicators</h3>
                            <ul id="claudeBiasIndicators"></ul>
                        </div>
                        <div class="analysis-card">
                            <h3>üìñ Language Analysis</h3>
                            <p id="claudeLanguageAnalysis">-</p>
                        </div>
                    </div>

                    <!-- Consensus Content -->
                    <div id="consensusAnalysis" class="model-content">
                        <div class="assessment-section">
                            <h3>‚úÖ Areas of Agreement</h3>
                            <ul id="areasOfAgreement"></ul>
                        </div>

                        <div class="assessment-section">
                            <h3>‚ö†Ô∏è Areas of Disagreement</h3>
                            <ul id="areasOfDisagreement"></ul>
                        </div>

                        <div class="assessment-section">
                            <h3>üéØ Final Assessment</h3>
                            <div id="finalAssessment" class="final-assessment-text"></div>
                        </div>

                        <div class="assessment-section">
                            <h3>üí° Recommendations</h3>
                            <ul id="recommendations"></ul>
                        </div>
                    </div>

                    <!-- Session Info -->
                    <div class="session-info">
                        Session ID: <code id="biasSessionId">-</code>
                        <span class="separator">‚Ä¢</span>
                        Processing Time: <span id="biasProcessingTime">0s</span>
                    </div>
                </div>

                <!-- Actions (shown for both tabs) -->
                <div class="results-actions">
                    <button id="exportBtn" class="btn-secondary">Export Report</button>
                    <button id="newCheckBtn" class="btn-primary">Analyze Another</button>
                </div>
            </section>

            <!-- Error Section -->
            <section id="errorSection" class="error-section" style="display: none;">
                <div class="error-box">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-content">
                        <h3>Error</h3>
                        <p id="errorMessage"></p>
                        <button id="retryBtn" class="btn-primary">Try Again</button>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>Powered by LangChain + Railway Browserless ‚Ä¢ <a href="/api/health" target="_blank">Health Check</a></p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>