<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Fact Checker, Bias Analyzer & Lie Detector</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç AI Content Analyzer</h1>
            <p class="subtitle">Verify facts, analyze bias, and detect deception in text</p>
        </header>

        <main>
            <!-- Mode Selection Section -->
            <section class="mode-selection-section">
                <h2>Choose Analysis Mode</h2>
                <div class="mode-tabs">
                    <button class="mode-tab active" data-mode="llm-output">
                        <span class="mode-icon">ü§ñ</span>
                        <span class="mode-label">LLM Output</span>
                        <span class="mode-desc">ChatGPT, Perplexity with sources</span>
                    </button>
                    <button class="mode-tab" data-mode="text-factcheck">
                        <span class="mode-icon">üîç</span>
                        <span class="mode-label">Full Fact-Check</span>
                        <span class="mode-desc">Verify all claims via web</span>
                    </button>
                    <button class="mode-tab" data-mode="key-claims">
                        <span class="mode-icon">üéØ</span>
                        <span class="mode-label">Key Claims</span>
                        <span class="mode-desc">Verify 2-3 main arguments</span>
                    </button>
                    <button class="mode-tab" data-mode="bias-analysis">
                        <span class="mode-icon">üìä</span>
                        <span class="mode-label">Bias Analysis</span>
                        <span class="mode-desc">Detect political bias</span>
                    </button>
                    <button class="mode-tab" data-mode="lie-detection">
                        <span class="mode-icon">üïµÔ∏è</span>
                        <span class="mode-label">Lie Detection</span>
                        <span class="mode-desc">Deception markers</span>
                    </button>
                </div>
            </section>

            <!-- Input Section -->
            <section class="input-section">
                <!-- LLM Output Mode Instructions -->
                <div id="llmOutputInstructions" class="mode-instructions">
                    <div class="instructions-card">
                        <h3>üìã How to Copy LLM Output</h3>
                        <div class="instructions-steps">
                            <div class="step">
                                <span class="step-number">1</span>
                                <span class="step-text">Go to <strong>ChatGPT</strong>, <strong>Perplexity</strong>, or any LLM chat</span>
                            </div>
                            <div class="step">
                                <span class="step-number">2</span>
                                <span class="step-text">Ask a question and get a response with <strong>source citations/links</strong></span>
                            </div>
                            <div class="step">
                                <span class="step-number">3</span>
                                <span class="step-text">Select and copy the entire response (with links)</span>
                            </div>
                            <div class="step">
                                <span class="step-number">4</span>
                                <span class="step-text">Paste it below and click <strong>Analyze</strong></span>
                            </div>
                        </div>
                        <div class="instructions-note">
                            <span class="note-icon">üí°</span>
                            <span>Works with HTML, Markdown, or plain text containing URLs</span>
                        </div>
                    </div>
                </div>

                <!-- Text Fact-Check Mode Instructions -->
                <div id="textFactcheckInstructions" class="mode-instructions" style="display: none;">
                    <div class="instructions-card">
                        <h3>üîç How Full Fact-Checking Works</h3>
                        <p>This mode extracts <strong>all verifiable facts</strong> and checks each one against web sources.</p>
                        <div class="instructions-steps">
                            <div class="step">
                                <span class="step-number">1</span>
                                <span class="step-text">Paste any article or text</span>
                            </div>
                            <div class="step">
                                <span class="step-number">2</span>
                                <span class="step-text">We extract <strong>all factual claims</strong> (dates, stats, names, etc.)</span>
                            </div>
                            <div class="step">
                                <span class="step-number">3</span>
                                <span class="step-text">Each fact is verified via web search</span>
                            </div>
                        </div>
                        <div class="instructions-note">
                            <span class="note-icon">‚è±Ô∏è</span>
                            <span>May take longer for content with many facts. Use <strong>Key Claims</strong> mode for faster analysis.</span>
                        </div>
                    </div>
                </div>

                <!-- Key Claims Mode Instructions -->
                <div id="keyClaimsInstructions" class="mode-instructions" style="display: none;">
                    <div class="instructions-card instructions-card-keyclaims">
                        <h3>üéØ Key Claims Analysis</h3>
                        <p>This mode identifies the <strong>2-3 central thesis statements</strong> and verifies them thoroughly.</p>
                        <div class="instructions-steps">
                            <div class="step">
                                <span class="step-number">1</span>
                                <span class="step-text">Paste any article or text</span>
                            </div>
                            <div class="step">
                                <span class="step-number">2</span>
                                <span class="step-text">We identify the <strong>main arguments</strong> (not supporting details)</span>
                            </div>
                            <div class="step">
                                <span class="step-number">3</span>
                                <span class="step-text">Each key claim gets <strong>thorough verification</strong></span>
                            </div>
                        </div>
                        <div class="instructions-note">
                            <span class="note-icon">üí°</span>
                            <span>Best for: "Is the main point of this article true?" ‚Äî Faster than full fact-check.</span>
                        </div>
                    </div>
                </div>

                <!-- Bias Analysis Mode Instructions -->
                <div id="biasAnalysisInstructions" class="mode-instructions" style="display: none;">
                    <div class="instructions-card">
                        <h3>üìä How Bias Analysis Works</h3>
                        <p>Detects political and ideological bias in news articles and opinion pieces.</p>
                        <div class="instructions-steps">
                            <div class="step">
                                <span class="step-number">1</span>
                                <span class="step-text">Paste a news article, op-ed, or any content</span>
                            </div>
                            <div class="step">
                                <span class="step-number">2</span>
                                <span class="step-text">Optionally enter the publication name for context</span>
                            </div>
                            <div class="step">
                                <span class="step-number">3</span>
                                <span class="step-text">Get a detailed bias report with specific examples</span>
                            </div>
                        </div>
                        <div class="instructions-note">
                            <span class="note-icon">‚öñÔ∏è</span>
                            <span>Works best with news articles, opinion pieces, and political content</span>
                        </div>
                    </div>
                </div>

                <!-- Lie Detection Mode Instructions -->
                <div id="lieDetectionInstructions" class="mode-instructions" style="display: none;">
                    <div class="instructions-card">
                        <h3>üïµÔ∏è How Lie Detection Works</h3>
                        <p>Analyzes text for linguistic markers commonly associated with deception.</p>
                        <div class="instructions-steps">
                            <div class="step">
                                <span class="step-number">1</span>
                                <span class="step-text">Paste any article, statement, or text</span>
                            </div>
                            <div class="step">
                                <span class="step-number">2</span>
                                <span class="step-text">AI analyzes linguistic patterns and markers</span>
                            </div>
                            <div class="step">
                                <span class="step-number">3</span>
                                <span class="step-text">Get deception risk score with specific examples</span>
                            </div>
                        </div>
                        <div class="instructions-note">
                            <span class="note-icon">‚ö†Ô∏è</span>
                            <span>This is probabilistic analysis, not definitive proof of deception</span>
                        </div>
                    </div>
                </div>

                <!-- Input Group -->
                <div class="input-group">
                    <label id="inputSectionTitle">Paste LLM Output with Sources</label>
                    <p class="input-help" id="inputHelpText">Paste ChatGPT, Perplexity, or any LLM output with source links</p>
                    <textarea 
                        id="htmlInput" 
                        placeholder="Paste your content here..."
                        rows="20"
                    ></textarea>
                    <div id="contentFormatIndicator" class="content-format-indicator" style="display: none;">
                        <span class="format-icon" id="formatIcon">‚úÖ</span>
                        <span class="format-message" id="formatMessage">Format detected</span>
                    </div>
                </div>

                <!-- Optional: Publication Name (only for bias analysis) -->
                <div class="input-group" id="publicationField" style="display: none;">
                    <label for="publicationName">Publication Name (Optional)</label>
                    <input 
                        type="text" 
                        id="publicationName" 
                        placeholder="e.g., The New York Times, Fox News, CNN"
                    >
                    <p class="input-help">Helps provide context for known publication biases</p>
                </div>

                <!-- Action Buttons -->
                <div class="input-actions">
                    <button id="checkBtn" class="btn-primary">
                        <span class="btn-icon">üöÄ</span>
                        Analyze
                    </button>
                    <button id="clearBtn" class="btn-secondary">
                        <span class="btn-icon">üóëÔ∏è</span>
                        Clear
                    </button>
                    <button id="stopBtn" class="btn-stop" style="display: none;" disabled>
                        <span class="btn-icon">‚èπÔ∏è</span>
                        Stop
                    </button>
                </div>
            </section>

            <!-- Plain Text Modal (for suggesting mode switch) -->
            <div id="plainTextModal" class="modal" style="display: none;">
                <div class="modal-content-improved">
                    <button id="closeModal" class="modal-close-btn" aria-label="Close">√ó</button>

                    <div class="modal-header">
                        <div class="modal-icon-warning">‚ö†Ô∏è</div>
                        <h3>No Source Links Detected</h3>
                        <p>This content appears to be plain text without source links.</p>
                    </div>

                    <div class="modal-body">
                        <p class="modal-subtitle">Choose an analysis mode:</p>

                        <div class="modal-options">
                            <button id="switchToKeyClaimsMode" class="option-card option-card-keyclaims">
                                <span class="option-card-icon">üéØ</span>
                                <div class="option-card-content">
                                    <h4>Key Claims (Recommended)</h4>
                                    <p>Verify 2-3 main arguments ‚Äî fast &amp; focused</p>
                                </div>
                            </button>

                            <button id="switchToTextMode" class="option-card">
                                <span class="option-card-icon">üîç</span>
                                <div class="option-card-content">
                                    <h4>Full Fact-Check</h4>
                                    <p>Verify all claims via web search</p>
                                </div>
                            </button>

                            <button id="switchToBiasMode" class="option-card">
                                <span class="option-card-icon">üìä</span>
                                <div class="option-card-content">
                                    <h4>Bias Analysis</h4>
                                    <p>Check for political/ideological bias</p>
                                </div>
                            </button>

                            <button id="switchToLieMode" class="option-card">
                                <span class="option-card-icon">üïµÔ∏è</span>
                                <div class="option-card-content">
                                    <h4>Lie Detection</h4>
                                    <p>Analyze deception markers</p>
                                </div>
                            </button>
                        </div>
                    </div>

                    <div class="modal-footer-improved">
                        <button id="continueAnyway" class="btn-text-link">
                            Continue with LLM mode anyway ‚Üí
                        </button>
                    </div>
                </div>
            </div>

            <!-- Status Section -->
            <section id="statusSection" class="status-section" style="display: none;">
                <div class="status-card">
                    <div class="status-header">
                        <div class="spinner"></div>
                        <span class="status-text">Analyzing content...</span>
                    </div>
                    <div class="progress-container">
                        <div id="progressLog" class="progress-log"></div>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section id="resultsSection" class="results-section" style="display: none;">
                <!-- Results Tabs -->
                <div class="results-tabs">
                    <button id="factCheckTab" class="results-tab active">
                        <span class="tab-icon">‚úÖ</span>
                        <span class="tab-label">Verification Results</span>
                    </button>
                    <button id="keyClaimsTab" class="results-tab" style="display: none;">
                        <span class="tab-icon">üéØ</span>
                        <span class="tab-label">Key Claims</span>
                    </button>
                    <button id="biasAnalysisTab" class="results-tab" style="display: none;">
                        <span class="tab-icon">üìä</span>
                        <span class="tab-label">Bias Analysis</span>
                    </button>
                    <button id="lieDetectionTab" class="results-tab" style="display: none;">
                        <span class="tab-icon">üïµÔ∏è</span>
                        <span class="tab-label">Lie Detection</span>
                    </button>
                </div>

                <!-- Fact Check Results (also used for LLM output and text fact-check) -->
                <div id="factCheckResults" class="results-content active">
                    <div class="summary-card">
                        <h3>Summary</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <span class="summary-value" id="totalFacts">0</span>
                                <span class="summary-label">Total Claims</span>
                            </div>
                            <div class="summary-item verified">
                                <span class="summary-value" id="verifiedCount">0</span>
                                <span class="summary-label">Verified</span>
                            </div>
                            <div class="summary-item partial">
                                <span class="summary-value" id="partialCount">0</span>
                                <span class="summary-label">Partial</span>
                            </div>
                            <div class="summary-item unverified">
                                <span class="summary-value" id="unverifiedCount">0</span>
                                <span class="summary-label">Issues</span>
                            </div>
                        </div>
                        <div class="pipeline-info">
                            <span class="pipeline-badge" id="pipelineBadge">LLM Output</span>
                            <span class="pipeline-desc" id="pipelineDesc">Checking interpretation of sources</span>
                        </div>
                    </div>

                    <h3>Detailed Results</h3>
                    <div id="factsList" class="facts-list"></div>

                    <div class="session-info">
                        Session ID: <code id="sessionId">-</code>
                        <span class="separator">‚Ä¢</span>
                        Processing Time: <span id="processingTime">0s</span>
                        <span class="separator" id="r2Sep" style="display: none;">‚Ä¢</span>
                        <a href="#" id="r2Link" target="_blank" style="display: none;">üìÑ View Full Report</a>
                    </div>
                </div>

                <!-- Key Claims Results -->
                <div id="keyClaimsResults" class="results-content" style="display: none;">
                    <div class="summary-card summary-card-keyclaims">
                        <h3>üéØ Key Claims Analysis</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <span class="summary-value" id="kcTotalClaims">0</span>
                                <span class="summary-label">Key Claims</span>
                            </div>
                            <div class="summary-item verified">
                                <span class="summary-value" id="kcVerifiedCount">0</span>
                                <span class="summary-label">Verified</span>
                            </div>
                            <div class="summary-item partial">
                                <span class="summary-value" id="kcPartialCount">0</span>
                                <span class="summary-label">Partial</span>
                            </div>
                            <div class="summary-item unverified">
                                <span class="summary-value" id="kcUnverifiedCount">0</span>
                                <span class="summary-label">Unverified</span>
                            </div>
                        </div>
                        <div class="overall-credibility">
                            <span class="credibility-label">Overall Assessment:</span>
                            <span class="credibility-value" id="kcOverallCredibility">-</span>
                        </div>
                    </div>

                    <h3>Key Claims Verification</h3>
                    <div id="keyClaimsList" class="facts-list"></div>

                    <div class="session-info">
                        Session ID: <code id="kcSessionId">-</code>
                        <span class="separator">‚Ä¢</span>
                        Processing Time: <span id="kcProcessingTime">0s</span>
                        <span class="separator" id="kcR2Sep" style="display: none;">‚Ä¢</span>
                        <a href="#" id="kcR2Link" target="_blank" style="display: none;">üìÑ View Full Report</a>
                    </div>
                </div>

                <!-- Bias Analysis Results -->
                <div id="biasAnalysisResults" class="results-content" style="display: none;">
                    <!-- Bias results content here - keep existing -->
                    <div class="bias-summary-card">
                        <h3>üìä Bias Analysis Summary</h3>
                        <div class="model-tabs">
                            <button class="model-tab active" data-model="gpt">GPT-4o</button>
                            <button class="model-tab" data-model="claude">Claude</button>
                        </div>
                        <div id="gptBiasResults" class="model-results active">
                            <div class="bias-meter">
                                <div class="bias-spectrum">
                                    <span class="spectrum-label left">Far Left</span>
                                    <div class="spectrum-bar">
                                        <div id="gptBiasIndicator" class="bias-indicator" style="left: 50%;"></div>
                                    </div>
                                    <span class="spectrum-label right">Far Right</span>
                                </div>
                                <div class="bias-label" id="gptBiasLabel">Center</div>
                            </div>
                            <div class="bias-details">
                                <div class="bias-score">
                                    <span class="score-label">Bias Score:</span>
                                    <span class="score-value" id="gptBiasScore">0</span>
                                    <span class="score-scale">(-10 to +10)</span>
                                </div>
                                <div class="confidence-score">
                                    <span class="score-label">Confidence:</span>
                                    <span class="score-value" id="gptConfidence">0%</span>
                                </div>
                            </div>
                        </div>
                        <div id="claudeBiasResults" class="model-results" style="display: none;">
                            <div class="bias-meter">
                                <div class="bias-spectrum">
                                    <span class="spectrum-label left">Far Left</span>
                                    <div class="spectrum-bar">
                                        <div id="claudeBiasIndicator" class="bias-indicator" style="left: 50%;"></div>
                                    </div>
                                    <span class="spectrum-label right">Far Right</span>
                                </div>
                                <div class="bias-label" id="claudeBiasLabel">Center</div>
                            </div>
                            <div class="bias-details">
                                <div class="bias-score">
                                    <span class="score-label">Bias Score:</span>
                                    <span class="score-value" id="claudeBiasScore">0</span>
                                    <span class="score-scale">(-10 to +10)</span>
                                </div>
                                <div class="confidence-score">
                                    <span class="score-label">Confidence:</span>
                                    <span class="score-value" id="claudeConfidence">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bias-indicators-card">
                        <h3>üîç Bias Indicators Found</h3>
                        <div id="biasIndicatorsList" class="bias-indicators-list"></div>
                    </div>

                    <div class="session-info">
                        Session ID: <code id="biasSessionId">-</code>
                        <span class="separator">‚Ä¢</span>
                        Processing Time: <span id="biasProcessingTime">0s</span>
                    </div>
                </div>

                <!-- Lie Detection Results -->
                <div id="lieDetectionResults" class="results-content" style="display: none;">
                    <div class="lie-detection-summary">
                        <div class="lie-summary-card risk-card">
                            <h3>‚ö†Ô∏è Deception Risk</h3>
                            <div class="risk-meter">
                                <span class="risk-value" id="lieRiskScore">0%</span>
                                <span class="risk-label" id="lieRiskLabel">Low Risk</span>
                            </div>
                        </div>
                        <div class="lie-summary-card credibility-card">
                            <h3>‚úÖ Credibility Score</h3>
                            <div class="credibility-meter">
                                <span class="credibility-value" id="lieCredibilityScore">0%</span>
                                <span class="credibility-label" id="lieCredibilityLabel">Unknown</span>
                            </div>
                        </div>
                    </div>

                    <div class="analysis-card">
                        <h3>üö© Deception Markers Found</h3>
                        <div id="lieMarkersList" class="markers-list"></div>
                    </div>

                    <div class="analysis-card">
                        <h3>‚úÖ Positive Indicators</h3>
                        <div id="liePositiveIndicators" class="positive-indicators"></div>
                    </div>

                    <div class="analysis-card">
                        <h3>üéØ Conclusion</h3>
                        <p id="lieConclusion" class="conclusion-text">-</p>
                    </div>

                    <details class="detailed-reasoning">
                        <summary>üîç View Detailed Reasoning</summary>
                        <p id="lieDetailedReasoning" class="reasoning-text">-</p>
                    </details>

                    <div class="session-info">
                        Session ID: <code id="lieSessionId">-</code>
                        <span class="separator">‚Ä¢</span>
                        Processing Time: <span id="lieProcessingTime">0s</span>
                        <span class="separator" id="lieR2Sep" style="display: none;">‚Ä¢</span>
                        <a href="#" id="lieR2Link" target="_blank" style="display: none;">üìÑ View Full Report</a>
                    </div>
                </div>

                <!-- Actions (shown for all tabs) -->
                <div class="results-actions">
                    <button id="exportBtn" class="btn-secondary">Export Report</button>
                    <button id="newCheckBtn" class="btn-primary">Analyze Another</button>
                </div>
            </section>

            <!-- Error Section -->
            <section id="errorSection" class="error-section" style="display: none;">
                <div class="error-box">
                    <div class="error-icon">‚ùå</div>
                    <div class="error-content">
                        <h3>Error</h3>
                        <p id="errorMessage"></p>
                        <button id="retryBtn" class="btn-primary">Try Again</button>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>Powered by LangChain + Claude + GPT-4 ‚Ä¢ <a href="/api/health" target="_blank">Health Check</a></p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>